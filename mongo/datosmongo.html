{% extends 'base.html' %}

{% block title %}Datos de MongoDB{% endblock %}

{% block content %}
<div class="header">
    <h1>Datos de MongoDB - Cluster0</h1>
    <div class="user-info">
        <span class="user-avatar">{{ username[0]|upper }}</span>
        <span class="username">¡Hola, {{ username }}!</span>
        <a href="{{ url_for('logout') }}" title="Cerrar Sesión"><i class="fas fa-power-off"></i></a>
    </div>
</div>

<div class="database-info">
    <h3>Información de Conexión</h3>
    <p><strong>Cluster:</strong> Cluster0.olgavu8.mongodb.net</p>
    <p><strong>Usuario:</strong> jhphill</p>
</div>

<div class="collections-section">
    <h3>Colecciones Disponibles</h3>
    <ul class="collection-list">
        {% for collection in collections %}
        <li>
            <a href="{{ url_for('show_collection', collection_name=collection) }}">{{ collection }}</a>
            <span class="count">({{ counts[loop.index0] }} documentos)</span>
        </li>
        {% endfor %}
    </ul>
</div>

{% if current_collection %}
<div class="table-section">
    <h3>Documentos en {{ current_collection }}</h3>
    <div class="document-controls">
        <form method="GET" action="{{ url_for('mongodb_data') }}">
            <input type="hidden" name="collection" value="{{ current_collection }}">
            <label for="limit">Mostrar:</label>
            <select name="limit" id="limit" onchange="this.form.submit()">
                <option value="10" {% if limit == 10 %}selected{% endif %}>10 documentos</option>
                <option value="25" {% if limit == 25 %}selected{% endif %}>25 documentos</option>
                <option value="50" {% if limit == 50 %}selected{% endif %}>50 documentos</option>
                <option value="100" {% if limit == 100 %}selected{% endif %}>100 documentos</option>
            </select>
        </form>
    </div>
    
    <div class="documents-container">
        {% for document in documents %}
        <div class="document-card">
            <pre style="white-space: pre-wrap; word-wrap: break-word; padding: 15px; background-color: var(--background-color); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color);">
                {{ document | tojson(indent=4) }}
            </pre>
        </div>
        {% endfor %}
    </div>
    
    {% if documents|length >= limit %}
    <div class="load-more">
        <button onclick="loadMoreDocuments()">Cargar más documentos</button>
    </div>
    {% endif %}
</div> 
{% endblock %}